---
import { fetchStrapiSingle } from "../lib/strapi";

// ‚ö° BUILD-TIME DATA FETCHING
// This page fetches data during build (astro build), NOT at runtime.
// If Strapi is unavailable, the build will fail with clear error messages.

const homepage = await fetchStrapiSingle("homepage");
console.log("Homepage response:", JSON.stringify(homepage, null, 2));
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Strapi Debug - Homepage</title>
    <style>
      body {
        font-family: monospace;
        padding: 2rem;
        background: #1a1a1a;
        color: #0f0;
      }
      pre {
        background: #000;
        padding: 1rem;
        border-radius: 8px;
        overflow-x: auto;
      }
      .error {
        color: #f00;
      }
      .success {
        color: #0f0;
      }
    </style>
  </head>
  <body>
    <h1>üîç Strapi Debug - Homepage Endpoint</h1>

    <h2>Endpoint:</h2>
    <pre>GET /api/homepage?populate[heroSection][populate]=heroImage</pre>

    <h2>Status:</h2>
    {
      homepage ? (
        <div class="success">
          <p>‚úÖ Successfully fetched homepage data</p>
        </div>
      ) : (
        <p class="error">‚ö†Ô∏è No data returned</p>
      )
    }

    <h2>Response Data:</h2>
    <pre>{JSON.stringify(homepage, null, 2)}</pre>

    {
      homepage?.data?.attributes?.heroSection && (
        <>
          <h2>Hero Section Data:</h2>
          <pre>
            {JSON.stringify(homepage.data.attributes.heroSection, null, 2)}
          </pre>
        </>
      )
    }

    <hr />
    <p>
      <a href="/" style="color: #0ff;">‚Üê Back to Homepage</a> |
      <a
        href="https://bayanbites.skyguyver.com/admin"
        style="color: #0ff;"
        target="_blank">Open Strapi Admin ‚Üí</a
      >
    </p>
  </body>
</html>
