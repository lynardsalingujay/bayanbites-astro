---
import { fetchStrapi, type MenuItem, type StrapiResponse } from "../lib/strapi";
import SimpleMenuCard from "../components/SimpleMenuCard.astro";

let menu: StrapiResponse<MenuItem> | null = null;
let error: string | null = null;

try {
  menu = await fetchStrapi<MenuItem>("menu-items");
} catch (e) {
  error = e instanceof Error ? e.message : "An unknown error occurred";
  if (import.meta.env.DEV) {
    console.error("Error fetching menu:", e);
  }
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Bayan Bites - Menu</title>
  </head>
  <body class="m-0 p-0 font-sans bg-gray-50">
    <main class="max-w-7xl mx-auto px-4 sm:px-8 py-8">
      <header class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-2">
          Bayan Bites Menu
        </h1>
        <p class="text-gray-600 text-lg">Delicious homemade Filipino cuisine</p>
      </header>

      {
        error ? (
          <div class="bg-red-50 border-2 border-red-300 rounded-lg p-6 text-center">
            <p class="my-2 text-red-900">⚠️ {error}</p>
            <p class="text-sm text-red-600">
              Please check your Strapi configuration and ensure the server is
              accessible.
            </p>
          </div>
        ) : menu?.data && menu.data.length > 0 ? (
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 md:gap-8">
            {menu.data.map((item: MenuItem) => (
              <SimpleMenuCard item={item} />
            ))}
          </div>
        ) : (
          <div class="text-center py-16 px-8 text-gray-600">
            <p class="my-2">No menu items found.</p>
            <p class="text-sm text-gray-400">
              Add items to your Strapi CMS to see them here.
            </p>
          </div>
        )
      }
    </main>
  </body>
</html>
